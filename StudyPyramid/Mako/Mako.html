<h2>Usage</h2>

<p><strong>If you are using web framework like Pyramid, you can skip this 'Usage' section, otherwise, you'd like to generate you own html by Mako, check this section. See samples in ./test_mako.py</strong></p>

<h3>Basic Usage</h3>

<p><strong>1. template.render()</strong></p>

<p>```
from mako.template import Template</p>

<p>mytemplate = Template('hello world!')
print mytemplate.render()
```</p>

<p><strong>2. template.render(key='value')</strong></p>

<p>```
from mako.template import Template</p>

<p>mytemplate = Template('hello ${name}!')
print mytemplate.render(name='jack')
```</p>

<p><strong>3. Call render with your own context</strong></p>

<p>```
from mako.template import Template
from mako.runtime import Context
from StringIO import StringIO</p>

<p>mytemplate = Template('hello ${name}!')
buf = StringIO()
ctx = Context(buf, name='jack')
mytemplate.render_context(ctx)
print buf.getvalue()
```</p>

<h3>Using File-Based Templates</h3>

<p>```
from mako.template import Template</p>

<p>mytemplate = Template(filename='/docs/mytmpl.txt')
print mytemplate.render()
```</p>

<p>For improved performance, a Template which is loaded from a file can also cache the source code to its generated module on the filesystem as a regular Python module file (i.e. a .py file). </p>

<p>```
from mako.template import Template</p>

<p>mytemplate = Template(filename='docs/mytmpl.txt', module<em>directory='/tmp/mako</em>modules')
print mytemplate.render()
<code>`
The value of</code>module<em>directory<code>above should be a path in `sys.path` for example, you are running python file above in the</code>/tmp/mako</em>modules<code>, this path will be in `sys.path`, thus</code>/tmp/mako<em>modules<code>is a qualified</code>module</em>direcotry``.</p>

<p>When the above code is rendered, a file <code>/tmp/mako_modules/docs/mytmpl.txt.py</code> is created containing the source code for the module. The next time a Template with the same arguments is created, this module file will be automatically re-used.</p>

<h3>Using <code>TemplateLookup</code></h3>

<p><strong>1. TemplateLookup</strong></p>

<p>```
from mako.template import Template
from mako.lookup import TemplateLookup</p>

<p>mylookup = TemplateLookup(directories=['/docs'])
mytemplate = Template("""&lt;%include file="header.txt"/> hello world!""", lookup=mylookup)
print mytemplate.render()
<code>``
Above, we created a textual template which includes the file</code>header.txt<code>. In this way, it will search in the directory</code>/docs<code>for the file</code>header.txt`.</p>

<p><strong>2. TemplateLookup.get_template(templatename)</strong></p>

<p>```
from mako.template import Template
from mako.lookup import TemplateLookup</p>

<p>mylookup = TemplateLookup(directories=['/docs'], module<em>directory='/tmp/mako</em>modules')</p>

<p>def serve<em>template(templatename, <strong>kwargs):
    mytemplate = mylookup.get</em>template(templatename)
    print mytemplate.render(</strong>kwargs)
```</p>

<p>TemplateLookup will look for templates in the <code>/docs</code> directory, and will store generated module files in the <code>/tmp/mako_modules</code> directory. If given <code>/etc/beans/info.txt</code> as templatename, it would search for the file <code>/docs/etc/beans/info.txt</code> and create a module file <code>/tmp/mako_modules/etc/beans/info.txt.py</code></p>

<p><strong>3. Setting the Collection Size</strong></p>

<p>mylookup = TemplateLookup(directories=['/docs'],
                module<em>directory='/tmp/mako</em>modules', collection_size=500)</p>

<p>The above lookup will continue to load templates into memory until it reaches a count of around 500. At that point, it will clean out a certain percentage of templates using a least recently used scheme.</p>

<p>Skip the rest of the part, if you do need to refer to it, check out: http://docs.makotemplates.org/en/latest/usage.html#basic-usage</p>

<h2>Syntax</h2>

<h3>Expression Substitution</h3>

<p><code>
this  is x: ${x}
</code>
If x is not supplied, it evaluates to a special value <code>UNDEFINED</code>.</p>

<p>The contents within the ${} tag are evaluated by Python directly, so full expressions are OK:</p>

<p><code>
pythagorean theorem:  ${pow(x,2) + pow(y,2)}
</code></p>

<h3>Expression Escaping</h3>

<p>${"this is some text" | u}</p>

<p>The above expression applies URL escaping to the expression, and produces this+is+some+text. The u name indicates URL escaping, whereas h represents HTML escaping, x represents XML escaping, and trim applies a trim function.</p>

<h3>Control Structures</h3>

<p>conditionals(<code>if/else</code>), loops(<code>while/for</code>) as well as things like <code>try/except</code></p>

<p><code>
% if x==5:
    this is some output
% endif
</code>
the % can appear anywhere on the line as long as no text precedes it; indentation is not significant. The full range of Python "colon" expressions are allowed here, including if/elif/else, while, for, and even def, although Mako has a built-in tag for defs which is more full-featured.</p>

<p><code>
% for a in ['one', 'two', 'three', 'four', 'five']:
    % if a[0] == 't':
    its two or three
    % elif a[0] == 'f':
    four/five
    % else:
    one
    % endif
% endfor
</code></p>

<p>The % sign can also be "escaped", if you actually want to emit a percent sign as the first non whitespace character on a line, by escaping it as in %%:</p>

<p>```
%% some text</p>

<pre><code>%% some more text
</code></pre>

<p>```</p>

<h3>The Loop Context</h3>

<p>```</p>

<ul>
% for a in ("one", "two", "three"):
    <li>Item ${loop.index}: ${a}</li>
% endfor
</ul>

<p>```</p>

<h3>Comments</h3>

<p>Comments come in two varieties. The single line comment uses ## as the first non-space characters on a line:</p>

<p>```</p>

<h2>this is a comment.</h2>

<p>...text ...
```</p>

<p>A multiline version exists using &lt;%doc> ...text... </%doc>:</p>

<p><code>
&lt;%doc&gt;
    these are comments
    more comments
&lt;/%doc&gt;
</code></p>

<h3>Newline Filters</h3>

<p><code>
here is a line that goes onto \
another line.
</code></p>

<p>The above text evaluates to:</p>

<p><code>
here is a line that goes onto another line.
</code></p>

<h3>Python Blocks</h3>

<p>Any arbitrary block of python can be dropped in using the <code>&lt;% %&gt;</code> tags:</p>

<p><code>
this is a template
&lt;%
    x = db.get_resource('foo')
    y = [z.element for z in x if x.frobnizzle==5]
%&gt;
% for elem in y:
    element: ${elem}
% endfor
</code></p>

<h3>Module-level Blocks</h3>

<p>A variant on &lt;% %> is the module-level code block, denoted by &lt;%! %>.</p>

<p>```
&lt;%!
    import mylib
    import re</p>

<pre><code>def filter(text):
    return re.sub(r'^@', '', text)
</code></pre>

<p>%>
```</p>

<p>The code doesn't have access to the template's context and is only executed when the template is loaded into memory (which can be only once per application, or more, depending on the runtime environment). Use the &lt;%! %> tags to declare your template's imports, as well as any pure-Python functions you might want to declare:</p>

<h3>Tags</h3>

<p>The tag is closed either by a contained slash character, or an explicit closing tag:</p>

<p>```
&lt;%include file="foo.txt"/></p>

<p>&lt;%def name="foo" buffered="True">
    this is a def
</%def>
```</p>

<p>All tags have a set of attributes which are defined for each tag. Some of these attributes are required. Also, many attributes support evaluation, meaning you can embed an expression (using ${}) inside the attribute text:</p>

<p><code>
&lt;%include file="/foo/bar/${myfile}.txt"/&gt;
</code></p>

<h4><code>&lt;%page&gt;</code></h4>

<p>This tag defines general characteristics of the template, including caching arguments, and optional lists of arguments which the template expects when invoked.</p>

<p><code>
&lt;%page args="x, y, z='default'"/&gt;
</code></p>

<p>Or a page tag that defines caching characteristics:</p>

<p><code>
&lt;%page cached="True" cache_type="memory"/&gt;
</code></p>

<p>Currently, 0.7.4 only one <code>&lt;%page&gt;</code> tag gets used per template, the rest get ignored. See more below.</p>

<h4><code>&lt;%include&gt;</code></h4>

<p>```
&lt;%include file="header.html"/></p>

<pre><code>hello world
</code></pre>

<p>&lt;%include file="footer.html"/>
```</p>

<p>Include also accepts arguments which are available as &lt;%page> arguments in the receiving template:</p>

<p><code>
&lt;%include file="toolbar.html" args="current_section='members', username='ed'"/&gt;
</code></p>

<h4><code>&lt;%def&gt;</code></h4>

<p>The %def tag defines a Python function which contains a set of content, that can be called at some other point in the template. The basic idea is simple:</p>

<p>```
&lt;%def name="myfunc(x)">
    this is myfunc, x is ${x}
</%def></p>

<p>${myfunc(7)}
```</p>

<h4><code>&lt;%block&gt;</code></h4>

<p><code>%block</code> is a tag that is close to a %def, except executes itself immediately in its base-most scope, and can also be anonymous (i.e. with no name):</p>

<p><code>
&lt;%block filter="h"&gt;
    some &lt;html&gt; stuff.
&lt;/%block&gt;
</code></p>

<p>jiawzhang: Not sure what is the <code>&lt;%block&gt;</code> for so far, see below for details.</p>

<h4><code>&lt;%namespace&gt;</code></h4>

<p><code>%namespace</code> is Mako's equivalent of Python's import statement. It allows access to all the rendering functions and metadata of other template files, plain Python modules, as well as locally defined "packages" of functions.</p>

<p><code>
&lt;%namespace file="functions.html" import="*"/&gt;
</code></p>

<p>See below for details.</p>

<h4><code>&lt;%inherit&gt;</code></h4>

<p>Inherit allows templates to arrange themselves in inheritance chains.</p>

<p><code>
&lt;%inherit file="base.html"/&gt;
</code></p>

<h4><code>&lt;%nsname:defname&gt;</code></h4>

<p>user-defined "tag"</p>

<p><code>
&lt;%mynamespace:somedef param="some value"&gt;
    this is the body
&lt;/%mynamespace:somedef&gt;
</code></p>

<h4><code>&lt;%call&gt;</code></h4>

<p>user-defined "tag" and is roughly equivalent to the <code>&lt;%nsname:defname&gt;</code> syntax described above.</p>

<h4><code>&lt;%doc&gt;</code></h4>

<p>For multiline comments, see above.</p>

<h4><code>&lt;%text&gt;</code></h4>

<p>This tag suspends the Mako lexer's normal parsing of Mako template directives, and returns its entire body contents as plain text. It is used pretty much to write documentation about Mako:</p>

<p><code>
&lt;%text filter="h"&gt;
    heres some fake mako ${syntax}
    &lt;%def name="x()"&gt;${x}&lt;/%def&gt;
&lt;/%text&gt;
</code></p>

<h4>Returning Early from a Template</h4>

<p>Sometimes you want to stop processing a template or &lt;%def> method in the middle and just use the text you’ve accumulated so far. You can use a return statement inside a Python block to do that.</p>

<p><code>
% if not len(records):
    No records found.
    &lt;% return %&gt;
% endif
</code></p>

<p>Or perhaps:</p>

<p><code>
&lt;%
    if not len(records):
        return
%&gt;
</code></p>
